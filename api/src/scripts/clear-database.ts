/**
 * Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… (ÐºÑ€Ð¾Ð¼Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ servers)
 */

import { prisma } from '../lib/prisma';

async function clearDatabase() {
  console.log('ðŸ—‘ï¸  ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…...\n');

  try {
    // ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… ÐºÐ»ÑŽÑ‡ÐµÐ¹
    await prisma.$executeRawUnsafe('SET FOREIGN_KEY_CHECKS = 0');

    // ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ð²ÑÐµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÐºÑ€Ð¾Ð¼Ðµ servers
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ media_persons...');
    await prisma.mediaPerson.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ media_tags...');
    await prisma.mediaTag.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ media...');
    await prisma.media.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ categories...');
    await prisma.category.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ tags...');
    await prisma.tag.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ marriages...');
    await prisma.marriage.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ persons...');
    await prisma.person.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ duplicates...');
    await prisma.duplicate.deleteMany({});
    
    console.log('â³ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ users...');
    await prisma.user.deleteMany({});

    // Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾
    await prisma.$executeRawUnsafe('SET FOREIGN_KEY_CHECKS = 1');

    console.log('\nâœ… Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð° (Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° servers ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð°)!');
    console.log('\nðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:');
    
    const serverCount = await prisma.server.count();
    console.log(`   Ð¡ÐµÑ€Ð²ÐµÑ€Ð¾Ð²: ${serverCount}`);
    
  } catch (error) {
    console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…:', error);
    throw error;
  }
}

clearDatabase()
  .catch(console.error)
  .finally(() => prisma.$disconnect());

